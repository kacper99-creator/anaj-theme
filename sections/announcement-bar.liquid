{% if section.blocks.size > 0 %}
<section
  id="anaj-announcement-bar-{{ section.id }}"
  class="anaj-announcement-bar"
  data-interval="{{ section.settings.rotation_interval | default: 2 }}"
>
  <div class="anaj-announcement-bar__inner">

    {%- for block in section.blocks -%}
      {%- if block.settings.message != blank -%}
        <div class="anaj-announcement-bar__slide" {{ block.shopify_attributes }}>
          <span class="anaj-announcement-bar__text">
            {{ block.settings.message }}
          </span>
        </div>
      {%- endif -%}
    {%- endfor -%}

  </div>
</section>
{% endif %}

<style>
  .anaj-announcement-bar {
    width: 100%;
  }

  .anaj-announcement-bar__inner {
    background: linear-gradient(90deg, #00a6ff 0%, #0088dd 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 6px 10px;
    min-height: 32px;
    overflow: hidden;
    text-align: center;
    position: relative;
  }

  .anaj-announcement-bar__text {
    color: #ffffff;
    font-weight: 600;
    font-size: 14px;
    margin: 0;
    line-height: 1.4;
    white-space: normal;
    display: inline-block;
    padding: 0 12px;
  }

  .anaj-announcement-bar__slide {
    position: absolute;
    left: 50%;
    top: 50%;
    /* Centrowanie tekstu, aby nie był obcięty w pasku ogłoszeń */
    transform: translate(-50%, -30%);
    opacity: 0;
    transition: opacity 0.35s ease, transform 0.35s ease;
    width: 100%;
    max-width: 100%;
    text-align: center;
    pointer-events: none;
  }

  .anaj-announcement-bar__slide.is-active {
    opacity: 1;
    transform: translate(-50%, -50%);
    pointer-events: auto;
  }

  @media (min-width: 768px) {
    .anaj-announcement-bar__inner {
      padding: 8px 12px;
      min-height: 36px;
    }

    .anaj-announcement-bar__text {
      font-size: 15px;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .anaj-announcement-bar__slide,
    .anaj-announcement-bar__slide.is-active {
      transition: none;
      transform: translate(-50%, -50%);
    }
  }
</style>

<script>
  (function() {
    function initBar() {
      var bar = document.getElementById("anaj-announcement-bar-{{ section.id }}");
      if (!bar) return;
      if (bar.dataset.inited === "true") return;
      bar.dataset.inited = "true";

      var slides = bar.querySelectorAll(".anaj-announcement-bar__slide");
      if (!slides.length) return;

      var index = 0;
      // Domyślnie przełączaj komunikaty co 2 sekundy
      var interval = (parseInt(bar.dataset.interval, 10) || 2) * 1000;

      function show(i) {
        slides.forEach(function(slide, n) {
          slide.classList.toggle("is-active", n === i);
        });
      }

      show(0);

      if (slides.length > 1) {
        setInterval(function() {
          index = (index + 1) % slides.length;
          show(index);
        }, interval);
      }
    }

    document.addEventListener("DOMContentLoaded", initBar);
    document.addEventListener("shopify:section:load", initBar);
  })();
</script>

{% schema %}
{
  "name": "ANAJ – Pasek ogłoszeń",
  "settings": [
    {
      "type": "range",
      "id": "rotation_interval",
      "label": "Czas pokazywania jednego komunikatu (sekundy)",
      "min": 2,
      "max": 10,
      "step": 1,
      "default": 2
    }
  ],
  "blocks": [
    {
      "type": "message",
      "name": "Komunikat",
      "settings": [
        {
          "type": "text",
          "id": "message",
          "label": "Treść",
          "default": "Standardowo wysyłka w 3 dni robocze."
        }
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [
    {
      "name": "ANAJ – Pasek ogłoszeń",
      "category": "Nagłówek",
      "blocks": [{ "type": "message" }]
    }
  ]
}
{% endschema %}
