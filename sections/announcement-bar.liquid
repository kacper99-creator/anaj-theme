{%- liquid
  assign has_messages = false
  for block in section.blocks
    if block.type == 'message' and block.settings.message != blank
      assign has_messages = true
      break
    endif
  endfor
-%}

{%- if has_messages -%}
<section
  id="anaj-announcement-bar"
  class="anaj-announcement-bar"
  role="status"
  aria-live="polite"
>
  <div class="anaj-announcement-bar__inner">
    {%- for block in section.blocks -%}
      {%- if block.type == 'message' and block.settings.message != blank -%}
        <div
          class="anaj-announcement-bar__slide"
          data-anaj-announcement-slide
          {{ block.shopify_attributes }}
        >
          <p class="anaj-announcement-bar__text">
            {{ block.settings.message | escape }}
          </p>
        </div>
      {%- endif -%}
    {%- endfor -%}
  </div>
</section>
{%- endif -%}

<style>
  .anaj-announcement-bar {
    width: 100%;
  }

  .anaj-announcement-bar__inner {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 40px;
    padding: 8px 16px;
    text-align: center;
    overflow: hidden;
    background: linear-gradient(90deg, #0b1f3b, #cba05a);
    position: relative;
  }

  .anaj-announcement-bar__text {
    margin: 0;
    color: #ffffff;
    font-size: 14px;
    line-height: 1.4;
    font-weight: 500;
  }

  @media (min-width: 768px) {
    .anaj-announcement-bar__inner {
      min-height: 48px;
      padding: 10px 24px;
    }

    .anaj-announcement-bar__text {
      font-size: 15px;
    }
  }

  .anaj-announcement-bar__slide {
    opacity: 0;
    transform: translateY(10px);
    pointer-events: none;
    position: absolute;
    left: 50%;
    transform-origin: center;
    transition: opacity 0.4s ease-out, transform 0.4s ease-out;
    width: 100%;
    max-width: 100%;
  }

  .anaj-announcement-bar__slide.is-active {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
    position: relative;
    left: auto;
  }

  @media (prefers-reduced-motion: reduce) {
    .anaj-announcement-bar__slide,
    .anaj-announcement-bar__slide.is-active {
      transition: none;
      transform: none;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var bar = document.getElementById('anaj-announcement-bar');
    if (!bar) return;

    var slides = bar.querySelectorAll('[data-anaj-announcement-slide]');
    if (!slides.length) return;

    var intervalSeconds = {{ section.settings.rotation_interval | default: 4 | json }};
    var currentIndex = 0;

    function showSlide(index) {
      slides.forEach(function(slide, i) {
        if (i === index) {
          slide.classList.add('is-active');
        } else {
          slide.classList.remove('is-active');
        }
      });
    }

    showSlide(currentIndex);

    if (slides.length > 1) {
      setInterval(function() {
        currentIndex = (currentIndex + 1) % slides.length;
        showSlide(currentIndex);
      }, intervalSeconds * 1000);
    }
  });
</script>

{% schema %}
{
  "name": "ANAJ – Pasek ogłoszeń",
  "settings": [
    {
      "type": "range",
      "id": "rotation_interval",
      "label": "Czas wyświetlania jednego komunikatu (sekundy)",
      "min": 2,
      "max": 10,
      "step": 1,
      "default": 4
    }
  ],
  "blocks": [
    {
      "type": "message",
      "name": "Komunikat",
      "settings": [
        {
          "type": "text",
          "id": "message",
          "label": "Treść komunikatu",
          "default": "Standardowo wysyłka w 3 dni robocze."
        }
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [
    {
      "name": "ANAJ – Pasek ogłoszeń",
      "category": "Nagłówek",
      "blocks": [
        {
          "type": "message"
        },
        {
          "type": "message"
        }
      ]
    }
  ]
}
{% endschema %}
